# extra_exchange

![Top](https://raw.github.com/wiki/Toshiyuki023Hori/extra_exchange/gifs/top_image.png)

## 概要

**「いらないもの ⇄ 欲しいもの」**

**ユーザー間で物々交換ができるサービスです。**

「誰かにとってのいらないもの」が、「誰かにとっての欲しいもの」となっていることはよくあることです。
このサービスでは、ユーザーの皆様が商品を投稿して、その商品同士をユーザー間で交換することでお互いが幸せになることができます。
取引は直接会って交換するので、郵送・梱包の手間もありません。

気楽にいらないものを処分し、自分の欲しいものをもらい、生活を豊かにすることができます。

## URL

[サイトトップページ](https://extra-exchane.herokuapp.com/top)
本サービスは、自分以外のユーザーが取引を送信または取引申請の承認を行う等、ユーザー間のやりとりがベースとなっております。
それに伴い、評価者様にとって確認が煩雑になってしまいますことをお詫び申し上げます。
少しでもご不便を感じずにご確認いただけるように、ゲスト用アカウントは 3 つご用意しておりますので、以下の 3 つのどれかのアカウントからログインしてご確認いただければ幸甚です。

- username : **guest1** / password : **password000**
- username : **guest2** / password : **password000**
- username : **guest3** / password : **password000**

## サービス概要 / 利用の流れ

### 1. ユーザー登録(ログイン)を行う

![Login](https://raw.github.com/wiki/Toshiyuki023Hori/extra_exchange/gifs/login.gif)

### 2. `欲しいものリスト`を作成する

各ユーザーは、自分の気になる商品を投稿している出品者の`欲しいものリスト`を参照し、それを自分が持っているか確認して交換が可能か判断をします。欲しいものは URL をつけることが可能で、URL をつけた場合はその欲しいものは`a`タグで表示されます。

![wantitem](https://raw.github.com/wiki/Toshiyuki023Hori/extra_exchange/gifs/wantitem.gif)

### 3. `商品`を投稿する

各ユーザーは自分のいらないものを投稿します。商品はカテゴリ分けされていて、画像も最低 1 枚投稿する必要があります。

![giveitem](https://raw.github.com/wiki/Toshiyuki023Hori/extra_exchange/gifs/giveitem.gif)

### 4.`ピックアップ地点`の追加

直接相対して取引を行うため、出品者が商品を渡せる場所を指定する必要があります。ピックアップ地点は最大で 3 件まで登録できます。テキストを使用することで、電車のみならずバス停などをピックアップ地点に登録することが可能です。

![pickup](https://raw.github.com/wiki/Toshiyuki023Hori/extra_exchange/gifs/pickup.gif)

### 5.リクエストを送る

商品の投稿者以外が商品の詳細ページにいくと、取引のリクエストを送信することができます。取引リクエストを送るには以下の 3 点を選択する必要があります。

- **`交換する商品`**(リクエストを送信するユーザー(以下、`ジョインユーザー`)の投稿した商品から)
- **`ピックアップ場所`**(商品を出品しているユーザー(以下、`ホストユーザー`)のピックアップ地点から)
- **`取引日時`**

![giveReq](https://raw.github.com/wiki/Toshiyuki023Hori/extra_exchange/gifs/give_send_req.gif)

※各商品へコメントを投稿することができます。これにより、リクエスト送信前に商品についての問い合わせを行うことができます。

![comment](https://raw.github.com/wiki/Toshiyuki023Hori/extra_exchange/gifs/comment.gif)

### 6. リクエストを承認する(`ホストユーザー`)

`ホストユーザー`は、送信されたリクエストが適当か確認を行う必要があります。`取引日時`や、`ジョインユーザー`が提示する`商品`が適当であるなら`ホストユーザー`はリクエストを承認し、正式に取引が開始されます。

![confirmreq](https://raw.github.com/wiki/Toshiyuki023Hori/extra_exchange/gifs/confirmreq.gif)

### 7. 取引終了まで

取引当日まで、`ホストユーザ`ーと`ジョインユーザー`間でプライベートメッセージで打ち合わせを行うことができます。当日の目印となる服装、集合場所等を相手と話し合うのが一般的な打ち合わせ内容です。

取引が完全に完了させるには 3 ステップが必要です。

1. **`ジョインユーザー`の取引成立報告**
   `ジョインユーザー`が成立の報告を完了させない限り、`ホストユーザー`は取引完了の報告を送信することができません。

![joinaccept](https://raw.github.com/wiki/Toshiyuki023Hori/extra_exchange/gifs/joinaccept.gif)

2. **`ホストユーザー`の取引完了報告**
   `ジョインユーザー`の取引が成立されてはじめて、`ホストユーザー`は完了を報告することができます。取引成立報告後は取引を取り消しすることができません。

![donedeal](https://raw.github.com/wiki/Toshiyuki023Hori/extra_exchange/gifs/donedeal.gif)

3. **取引完了**
   `ホストユーザー`が取引完了を報告して正式に取引が完全に完了となります。

取引完了後は、お互いの使用された商品はリクエストの送信に使用することもできず、画面上でも`Exchanged`と交換済みとマークされるようになります。

## 使用技術

### フロントエンド

- React 16.3.1
  - React Redux(redux-thunx)
  - styled-omponents(polished)
- HTML/CSS(Sass)
- JavaScript

### バックエンド

- Python 3.9.0
- Django 3.1.1
  - Django REST framework

### 外部 API

- [HeartRails Express](http://express.heartrails.com/)

### 開発環境

- MySQL

### 本番環境

- Heroku
  - WhiteNoise
  - Gunicorn
- PostgreSQL(Heroku Postgres)
- AWS(S3)

### その他

- Git flow を意識した開発
  - issue を発行、プルリクエストを作成し、Master とマージする際に issue もクローズするように記述
- Git コミットメッセージと issue 番号の紐付け
- Git コミットメッセージの規則を持った記述([参考](https://qiita.com/itosho/items/9565c6ad2ffc24c09364))

##　機能一覧

### 認証機能

- 登録、サインイン機能(`django-rest-auth`,`django-allauth`)
  - 登録時にユーザー名(固有)、メールアドレス(固有)、パスワード必須
  - ログイン時にユーザー名、パスワード必須
  - 全ページでログインしているかを確認し、必要によっては表示の変更、トップ・ログイン画面へリダイレクト(`React Redux`)
- パスワード変更機能(`django-rest-auth`, `django-allauth`)

### 投稿機能

- `欲しいもの`
  - `欲しいもの`の新規作成,編集,削除(いずれも登録済みユーザー限定機能 ※閲覧は可能)
  - `欲しいもの`が URL を持っている場合、URL 先へ飛べるように条件分岐して表示
- `商品`
  - `商品`の新規作成、編集、削除(いずれも登録済みユーザー限定機能　※閲覧は可能)
  - 画像アップロード機能(画像専用の OneToMany 関係のテーブルを用意)
  - 詳細ページにて、関連している画像をカルーセルで表示(`React Swiper`)
  - 詳細ページにて、ゲストユーザー、ログインユーザー(リクエスト送信済みか否か、商品の投稿者か否か)、交換済みかで描画を変化し表示
  - ページネーションを用いて、カード形式でリスト表示(`react-paginate`)
  - 取引が終了した`商品`は Exchange のタグをつけて表示
- `ピックアップ地点`

  - 外部 API を用いて、東京都内の路線を全取得
  - ユーザーが選択した路線に応じて、その路線の全駅を取得
  - 上記の路線、駅を用いたドロップダウンを用いた新規投稿機能
  - テキストを用いた新規投稿機能
  - `ピックアップ地点`の新規投稿、削除(閲覧は可能)

- `カテゴリ`

  - カテゴリページにて、`商品`をカテゴリごとに表示
  - 商品詳細ページから編集可能

- `キーワード`

  - `欲しいものリスト`、`商品`それぞれにキーワードを設定(最大 3 つまで)
  - 上記 2 つそれぞれの編集画面から新規作成、編集、削除可能

- `リクエスト`

  - `リクエスト`の新規投稿、削除機能(登録済みユーザー限定機能)
  - リクエストの承認の状況によって、描画を変化し表示

- `取引`
  - `取引`の新規投稿、削除機能(登録済みユーザー限定機能)
  - `ジョインユーザー`の成立報告が完了するまで、`ホストユーザー`の完了報告を無効化
  - 取引完了後に、取引で使われた`商品`を交換済みに更新

### コメント機能

- `商品`詳細ページから各商品へのコメントの新規作成
- 投稿後にコメント削除可能(コメント投稿者限定機能)
- 投稿者が、その商品の出品者かそれ以外かのユーザーかで描画を変化し表示

### プライペートメッセージ機能

- `取引`詳細ページから各取引へのメッセージの新規作成
- 投稿後にメッセージ削除可能(メッセージ投稿者限定機能)
- 投稿者が、その取引の`ホストユーザー`か`ジョインユーザー`かで描画を変化し表示

### カテゴリ機能

- 全カテゴリページで、カテゴリごとに`商品`を表示

### ユーザー機能

- サイドバー(ユーザー情報ページ、アカウント情報編集ページ、パスワード変更ページ、欲しいものリスト追加・編集ページ、商品出品ページ、ピックアップリスト追加・編集ページ)は、訪問者がユーザー本人かで描画を変化し表示(本人以外なら、ユーザー情報ページへのリンクのみ表示)
- ユーザー詳細ページにて、ユーザーネーム、メールアドレス、アイコン、背景、プロフィールが編集可能
- ユーザー詳細ページにて、アイコン若しくは背景が未設定の場合、デフォルトの画像を表示
- ヘッダーへログアウトボタン設置(`django-rest-auth`, `django-allauth`)
